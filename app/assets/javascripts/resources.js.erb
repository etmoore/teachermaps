$(document).ready(function(){    

  

  //////////////////////////////
  //
  // Create Resources 
  //
  //////////////////////////////


  $(document)
  .on('ajax:error', "#create_resource_link_form", function(event, data, status, xhr) {
      $("#put_resource_link_errors").html(data.responseText);      
  })
  .on('ajax:success', "#create_resource_link_form", function(event, response, status, xhr) {
      
      data = $.parseJSON(response);

      if (data != undefined) {
          if (data.resources != undefined) {
              $("#resources_table").html(data.resources);
          }
          if (data.filters != undefined) {
              $('.resource_filter').html(data.filters);
          }
      }

      // Flash user of the success
      pushFlash({message:"<%= I18n.t('resources.upload_success') %>", state: 'success', fadeOut: 5000});
      // Hide all modals
      $('.modal.in').modal('hide');   
      // Rest form
      $(this)[0].reset();
      // Clear any error notification
      $("#uploadResourcesErrors").html('');  
      closeModalOnSubmit();
  });



  //////////////////////////////
  //
  // Edit Resources 
  //
  //////////////////////////////


  $(document)
  .on('ajax:error', "#edit_resource_link_form", function(event, data, status, xhr) {
      // Not sure why I have to use the responseText here
      $("#edit_resource_link_errors").html(data.responseText);      
  })
  .on('ajax:success', "#edit_resource_link_form", function(event, response, status, xhr) {

    data = $.parseJSON(response);

    if (data != undefined) {
      if (data.resources != undefined) {
        // Update the resources table
        $("#resources_table").html(data.resources);
      }
      if (data.filters != undefined) {
        console.log("Updating filters");
        console.log(data.filters);
        $('.resource_filter').html(data.filters);
      }
    }

    // Flash user of the success
    pushFlash({message:"<%= I18n.t('resources.edit_success') %>", state: 'success', fadeOut: 5000});
    $("#uploadResourcesErrors").html('');  
    closeModalOnSubmit();
  });

  $(document).on('click', ".edit_resource_link_view", function(e) {

      var resourceId = $(this).attr('resource-id');
      
      if (resourceId == undefined) return false;

      $.ajax({
        url: '/resources/'+resourceId+'/edit',
        dataType: 'html'
      }).done(function(data) {
          $('#edit_resource_link_modal_body').html(data);
          $('#edit_resource_link_modal').modal('show');
          $('#show_resource_link_modal').modal('hide');
      });   

      e.stopPropagation();
  });
    
});




