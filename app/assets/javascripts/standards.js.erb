$(document).ready(function(){    





    
    
    //////////////////////////////
    //
    // Filter Standards 
    //
    //////////////////////////////

    var timer;
    $(document).on('keyup input', '#filter_standards_search', function() {
        var form = $(this);
        // Prevents ajax request till N milliseconds 
        timer && clearTimeout(timer);
        timer = setTimeout(function(){ 
            form.submit();
        }, 500);
    });

    // Needed for browser compatibility 
    $(document).on('change', '#filter_standards_form', function() {
        $(this).submit();
    });

    $(document)
    .on("ajax:error", "#filter_standards_form", function(event, data, status, xhr) {
        pushFlash({message:"<%= I18n.t('resources.filter_failure') %>", state: 'success', fadeOut: 5000});
    })
    .on("ajax:success", "#filter_standards_form", function(event, data, status, xhr) {
        // Update the resources table
        $("#standards_table").html(data);  
    });



    //////////////////////////////
    //
    // Adding/Removing Map Standards
    //
    //////////////////////////////


    $(document).on("click", '#standards_list .standard-selected', function(e) {


        var standardId = $(this).attr('standard-id');
        var mapId = $('#map-id').val();
        if(standardId == undefined || mapId == undefined) return false;

        console.log("Removing Standard from Map: " + standardId + " From Map: " + mapId);

        var requestURL = '/ajax/maps/'+mapId+'/map_standards/'+standardId+'/destroy';

        $.ajax({
          url: requestURL,
          dataType: 'html'
        }).done(function(data) {
          console.log("Removed Standard from Map: " + standardId + " From Map: " + mapId);
          $('#map_standards_list').html(data);
        });   

        $(this).attr('class','standard-default');

        e.stopPropagation();
    });

    $(document).on("click", '#standards_list .standard-default', function(e) {
    
        var standardId = $(this).attr('standard-id');
        var mapId = $('#map-id').val();
        if(standardId == undefined || mapId == undefined) return false;

        console.log("Adding Standard from Map: " + standardId + " From Map: " + mapId);

        var requestURL = '/ajax/maps/'+mapId+'/map_standards/'+standardId+'/new';

        $.ajax({
          url: requestURL,
          dataType: 'html'
        }).done(function(data) {
          console.log("Added Standard from Map: " + standardId + " From Map: " + mapId);
          $('#map_standards_list').html(data);
        });   

        // Mark all children standards as selected
        $(this).find('.standard-default').each(function() {
            $(this).attr('class','standard-selected');
        });

        $(this).attr('class','standard-selected');

        e.stopPropagation();
    });


    
});




