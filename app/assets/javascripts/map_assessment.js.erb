$(document).ready(function(){

    //////////////////////////////
    //
    // Filter Resources for Map
    //
    //////////////////////////////

    var timer;
    $(document).on('keyup input', "#maps_filter_resource_search", function() {
        var form = $(this);
        // Prevents ajax request till N milliseconds 
        timer && clearTimeout(timer);
        timer = setTimeout(function(){ 
            form.submit();
        }, 500);
    });

    // Needed for browser compatibility 
    $(document).on('change', '#maps_filter_resource_form', function() {
        $(this).submit();
    });

    $(document)
    .on("ajax:error", "#maps_filter_resource_form", function(event, data, status, xhr) {
        pushFlash({message:"<%= I18n.t('resources.filter_failure') %>", state: 'success', fadeOut: 5000});
    })
    .on("ajax:success", "#maps_filter_resource_form", function(event, data, status, xhr) {
        // Update the resources table
        $("#maps_map_assessments_resources_table").html(data);  
    });

    //////////////////////////////
    //
    // Adding/Removing Map Standards
    //
    //////////////////////////////


    $(document).on("click", '#maps_map_assessments_resources_table .map_assessment_resource_selected', function(e) {

        // /ajax/map_assessments/:map_asssessment_id/map_resources/:map_resource_id/destroy
        var mapAssessmentId = $(this).attr('map-assessment-id');
        var resourceId = $(this).attr('resource-id'); 
        var actionUrl = '/ajax/map_assessments/'+mapAssessmentId+'/map_resources/'+resourceId+'/destroy'
        var resourceElem = $(this);

        console.log("Removing map resource to assessment: "+actionUrl)

        if(mapAssessmentId == undefined || resourceId == undefined) return false;

        $.ajax({
            url: actionUrl,
            dataType: 'html',
            success: function (response) {
                console.log("Removed map resource to assessment: "+actionUrl)
                $('#maps_list_map_assessments').html(response);

                resourceElem.attr('class','map_assessment_resource_default');
            },
            error: function (xhr, ajaxOptions, thrownError) {
                pushFlash({message:"Error removing resource to Map Assessment", state: 'error', fadeOut: 5000});
            }
        });  

        e.stopPropagation();
    });

    $(document).on("click", '#maps_map_assessments_resources_table .map_assessment_resource_default', function(e) {
        
        // /ajax/map_assessments/:map_asssessment_id/map_resources/:map_resource_id/new
        var mapAssessmentId = $(this).attr('map-assessment-id');
        var resourceId = $(this).attr('resource-id'); 
        var actionUrl = '/ajax/map_assessments/'+mapAssessmentId+'/map_resources/'+resourceId+'/new'
        var resourceElem = $(this);

        console.log("Removing map resource to assessment: "+actionUrl)

        if(mapAssessmentId == undefined || resourceId == undefined) return false;

        $.ajax({
            url: actionUrl,
            dataType: 'html',
            success: function (response) {
                console.log("Added map resource to assessment: "+actionUrl)
                $('#maps_list_map_assessments').html(response);

                resourceElem.attr('class','map_assessment_resource_selected');
            },
            error: function (xhr, ajaxOptions, thrownError) {
                pushFlash({message:"Error adding resource to Map Assessment", state: 'error', fadeOut: 5000});
            }
        });   
        
        e.stopPropagation();
    });


});



    










