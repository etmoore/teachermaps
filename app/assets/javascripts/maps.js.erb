$(document).ready(function() {    

    $(".best_in_place").best_in_place();


    $('#map_standards_list ul li').on("click", function(e) {
        var mapURI = $(this).attr('action-url');
        window.location = mapURI;
        return;
    });

    //////////////////////////////
    //
    // Add Unit Assessment to Map
    //
    //////////////////////////////


    $('#create_map_assessment').on("click", function(e) {

        var userId = $('#user-id').val();
        var mapId = $('#map-id').val();
        var actionUrl = $(this).attr('action-url');

        if(userId == undefined || mapId == undefined || actionUrl == undefined) return false;

        // console.log("Adding assessment to Map: " + mapId + " owned by " + userId + " via path " + actionUrl);

        $.ajax({
            data: { 
                'map_assessment': { 'user_id' : userId, 'map_id' : mapId }
            },
            type: 'POST',
            url: actionUrl,
            dataType: 'html',
            success: function (response) {
                $('#maps_list_map_assessments').html(response);
            },
            error: function (xhr, ajaxOptions, thrownError) {
                pushFlash({message:"Error adding a Map Assessment", state: 'error', fadeOut: 5000});
            }
        });

        e.stopPropagation();
    });

    //////////////////////////////
    //
    // Remove Unit Assessment to Map
    //
    //////////////////////////////


    $(".maps_map_assessments_destroy")
    .on("ajax:error", function(event, data, status, xhr) {
        pushFlash({message:"Error deleting Map Assessment", state: 'error', fadeOut: 5000});
    })
    .on("ajax:success", function(event, data, status, xhr) {
        $('#maps_list_map_assessments').html(data);
    });

    $(".maps_map_assessments_show_resources")
    .on("ajax:error", function(event, data, status, xhr) {
        pushFlash({message:"Error fetching Map Assessment resources", state: 'error', fadeOut: 5000});
    })
    .on("ajax:success", function(event, data, status, xhr) {
        $('#filter_map_resources_modal').html(data);        
    });


});