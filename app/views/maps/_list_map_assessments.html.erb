<% if !@map.map_assessments.empty? %>
  
  <ul style="list-style-type:none;" id="sortable_map_assessments" action-id="<%= @map.id %>">

    <% @map.map_assessments.each do |map_assessment| %>
      <li id="map_assessment_<%= map_assessment.id %>">
        <div class="row editable">
          <div class="handle pull-left" style="cursor:move;"><%= image_tag 'large-click-drag-handle.png', alt: 'handle', size: '20x60' %></div>

          <div class="span9">
            
            <b><%= best_in_place map_assessment, :name, :type => :input, html_attrs: { style: "width:90%" } %></b>
            <p style="width:90%"><%= best_in_place map_assessment, :text, :type => :textarea, :nil => raw('<span class="gray">Description</span>') %></p>

            <% if !map_assessment.map_resources.empty? %>
              <% map_assessment.map_resources.each do |map_resource| %>
                <div style="padding-left:50px;">
                  <div>
                    <span title="<%= map_resource.resource.get_type %>" style="width:35px;"><%= raw map_resource.resource.get_thumbnail %></span>
                    <span><b><%= link_to map_resource.resource.title.titlecase, resource_path(map_resource.resource),  :target => "_blank" %>:</b></span>
                    <br/>
                    <span><%= best_in_place map_resource, :text, :type => :textarea, :nil => raw('<span class="gray">Description</span>'), html_attrs: { style: "width:90%" } %></span>
                  </div>
                </div>
              <% end %>
            <% end %>
          </div>

          <div class="pull-right">
            <%= link_to map_assessment, confirm: t('maps.delete_map_assessment_confirmation', title: map_assessment.name),  method: :delete, title: t('maps.delete_map_assessment'), :class=>"maps_map_assessments_destroy", remote: true do %>
              <i class="icon-trash"></i>
            <% end %>
            <br/>
            <%= link_to show_resources_map_assessment_path(map_assessment), {remote: true, 'data-toggle' => "modal", 'data-target' =>  "#filter_map_resources_modal", title: t('maps.edit_map_assessment_resources'), :class => 'maps_map_assessments_show_resources'} do %>
              <i class="icon-pencil"></i>
            <% end %>
          </div>
        </div>
        <br/>
      </li>
    <% end %>
  </ul>
<% end %> 


<script type="text/javascript">
$(document).ready(function() {    
  
  $('.best_in_place').best_in_place();

  $("#sortable_map_assessments").sortable({
    axis: 'y',
    dropOnEmpty: false,
    handle: '.handle',
    cursor: 'crosshair',
    items: 'li',
    opacity: 0.4,
    scroll: true,
    update: function(event, ui){
      var droppedItem = ui.item;
      var actionId = $(this).attr('action-id');
      var orderedData = $('#sortable_map_assessments').sortable('serialize');

      $.ajax({
        type: 'post',
        data: {id: actionId, new_positions: orderedData},
        dataType: 'script',
        complete: function(request){
          $(droppedItem).effect('highlight',{color:'#DBDBFF'},2000);
        },
        url: '/map_assessments/sort'
      })
    }
  });
});
</script>